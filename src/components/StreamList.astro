---
import { clsx } from "clsx";
import { getCollection } from "astro:content";
import { dateOptions, parseDateFromId } from "../utils/types";
import { getImageAspectRatiosArray } from "../utils/getImageAspectRatios";
interface Props {
  posts: Awaited<ReturnType<typeof getCollection<"stream">>>;
}

const { posts } = Astro.props;
const streamIds = posts.map((post) => post.data.photo);
const photos = await getImageAspectRatiosArray(streamIds);
---

{
  posts.map((post, index) => (
    <li
      class={clsx("relative text-sm lg:col-span-2 self-end", {
        "sm:col-span-2 lg:col-span-4": photos[index].aspectRatio > 1,
      })}
    >
      <a class="group" href={`/stream/${post.id}/`}>
        <img
          src={`https://imagedelivery.net/tfgleCjJafHVtd2F4ngDnQ/${photos[index].cloudflareId}/medium`}
          alt=""
          class={clsx("rounded-xs border-4", {
            "self-stretch object-cover w-full h-full":
              photos[index].aspectRatio > 1,
          })}
        />

        <p class="opacity-0 group-hover:opacity-100 transition-opacity absolute -bottom-6 right-0 text-white/70 mt-2">
          {parseDateFromId(post.id).toLocaleDateString("en-GB", dateOptions)}
        </p>
      </a>
    </li>
  ))
}
